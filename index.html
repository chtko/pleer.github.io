<!DOCTYPE html>
<html>
<head>
    <title>Музыкальный плеер</title>
    <style>
        body {
            background-color: white; /* Белый фон */
        }

        /* Стили для области перетаскивания файла */
        #dropArea {
            border: 2px dashed #fff;
            padding: 20px;
            text-align: center;
            width: 100%;
            height: 100vh;
            background-color: white; /* Белый фон по умолчанию */
        }
    </style>
</head>
<body>
    <h1>Музыкальный плеер</h1>
    
    <audio id="audio" controls>
        <source src="" type="audio/mpeg"> <!-- Добавлено поддержку audio/mpeg -->
        <source src="" type="audio/mp3">
        <source src="" type="audio/ogg">
        <source src="" type="audio/wav">
        <source src="" type="audio/mp4">
        <source src="" type="audio/x-m4a">
        <source src="" type="audio/mpegurl"> <!-- Добавлено поддержку M3U -->
    </audio>

    <script>
        const audio = document.getElementById('audio');
        audio.volume = 0.25; // Устанавливаем начальную громкость в 25%
    </script>

    <div>
        <input type="file" accept=".mp3,.ogg,.wav,.mp4,.m4a,.m3u" id="audioFile" style="display: none">
        <button onclick="document.getElementById('audioFile').click()">Загрузить музыку</button>
    </div>
    
    <div>
        <input type="url" id="audioURL" placeholder="Вставьте URL интернет радио или M3U-плейлист">
        <button onclick="playInternetRadioWithRetries()">Воспроизвести музыку интернет радио по URL</button> <!-- Название функции не меняется -->
    </div>

    <!-- Добавляем область для перетаскивания файла -->
    <div id="dropArea" 
        ondrop="dropHandler(event);" 
        ondragover="dragOverHandler(event);"
        ondragleave="dragLeaveHandler(event);">
        <p>Перетащите файл с музыкой сюда, чтобы воспроизвести его в плеере</p>
    </div>
    
    <script>
        const audioFile = document.getElementById('audioFile');
        const audioURL = document.getElementById('audioURL');
        const dropArea = document.getElementById('dropArea');
        let retryAttempts = 3; // Количество попыток воспроизведения

        // Измененная функция для воспроизведения музыки по URL с попытками
        function playInternetRadioWithRetries() {
            retryAttempts = 3; // Сбрасываем число попыток при каждой попытке
            tryAudio(); // Запускаем первую попытку
        }

        // Функция для попытки воспроизведения аудио
        function tryAudio() {
            audio.src = audioURL.value;
            audio.play()
                .then(() => {
                    // Если воспроизведение успешно, не нужно больше попыток
                    retryAttempts = 0;
                })
                .catch(error => {
                    if (retryAttempts > 0) {
                        retryAttempts--;
                        // Если есть еще попытки, пробуем снова через 3 секунды
                        setTimeout(tryAudio, 3000);
                    }
                    // Здесь вы можете добавить обработку ошибок, например, вывод сообщения об ошибке
                });
        }

        audioFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const objectURL = URL.createObjectURL(file);
                audio.src = objectURL;
            }
        });

        function dropHandler(event) {
            event.preventDefault();
            dropArea.style.backgroundColor = 'white';
            const file = event.dataTransfer.files[0];
            if (file) {
                const objectURL = URL.createObjectURL(file);
                audio.src = objectURL;
            }
        }

        function dragOverHandler(event) {
            event.preventDefault();
            dropArea.style.backgroundColor = 'lightblue';
        }

        function dragLeaveHandler(event) {
            event.preventDefault();
            dropArea.style.backgroundColor = 'white';
        }

        window.addEventListener('beforeunload', function (e) {
            e.returnValue = 'Вы точно хотите закрыть сайт? Музыка перестанет играть, и плеер будет очищен, но файл останется на вашем ПК.';
        });
    </script>
</body>
</html>
